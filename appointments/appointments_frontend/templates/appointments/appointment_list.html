{# ============================================================================
   appointments/appointment_list.html
   Purpose:
     - Display a list of appointments for the logged-in user.
     - Use card layout with status-based styling.
     - Include cancel buttons for upcoming appointments.
     - Integrate breadcrumbs and modal confirmation.
   Context expected:
     - appointments: list of Appointment objects
     - crumbs: breadcrumb trail (list of {label, url})
   ============================================================================ #}

{% extends 'base.html' %}

{% block content %}
<div class="container my-4">

  {# Breadcrumbs for navigation context #}
  {% include 'includes/breadcrumbs.html' with crumbs=crumbs %}

  <h2 class="mb-3">My Appointments</h2>
  <p class="text-muted">Here are your upcoming and past appointments.</p>

  {% if appointments %}
    <div class="appointment-list">
      {% for appointment in appointments %}
        <div class="appointment-card">
          <div class="appointment-info">
            <h3>{{ appointment.doctor.get_full_name }}</h3>
            <p><strong>Date:</strong> {{ appointment.scheduled_time|date:"M d, Y" }}</p>
            <p><strong>Time:</strong> {{ appointment.scheduled_time|time:"H:i" }}</p>
            <p><strong>Reason:</strong> {{ appointment.reason|default:"â€”" }}</p>
          </div>

          <div class="appointment-status text-end">
            <p class="status {{ appointment.status|lower }}">
              <strong>Status:</strong> {{ appointment.get_status_display }}
            </p>

            {% if appointment.status == 'pending' or appointment.status == 'confirmed' %}
              <button class="btn-cancel" onclick="openConfirmModal('{{ appointment.id }}')">
                Cancel
              </button>
            {% endif %}
          </div>
        </div>
      {% endfor %}
    </div>
  {% else %}
    <div class="alert alert-info">
      You have no appointments yet. <a href="{% url 'appointments:create' %}">Book one now</a>.
    </div>
  {% endif %}

  {# Modal for confirming cancellation #}
  {% include 'components/ConfirmationModal.html' %}

</div>

{# JS for handling cancellation modal #}
<script src="{% static 'appointments/js/appointments.js' %}"></script>
{% endblock %}
