{% extends "base.html" %}
{% load static %}

{% block title %}Change Password - MedApp{% endblock %}

{% block styles %}
<link rel="stylesheet" href="{% static 'accounts/css/accounts.css' %}">
{% endblock %}

{% block content %}
<div class="container password-change-container">
  {% include "includes/breadcrumbs.html" with crumbs=crumbs %}

  {# Display Django messages #}
  {% if messages %}
    {% for message in messages %}
      <div class="alert alert-{{ message.tags }}" role="alert">
        {{ message }}
      </div>
    {% endfor %}
  {% endif %}

  <div class="password-change-card">
    <div class="password-change-header">
      <h1>Change Password</h1>
      <p class="text-muted">Update your password to keep your account secure</p>
    </div>

    <form method="post" action="{% url 'accounts:password_change' %}" id="passwordChangeForm" class="password-change-form">
      {% csrf_token %}

      {# Current Password Field #}
      <div class="form-group">
        <label for="id_old_password">Current Password *</label>
        <div class="password-field">
          <input 
            type="password" 
            name="old_password" 
            id="id_old_password"
            class="form-control {% if form.old_password.errors %}is-invalid{% endif %}"
            placeholder="Enter your current password"
            required
            autofocus
          >
          <button type="button" class="password-toggle" data-target="id_old_password" aria-label="Toggle password visibility">
            <span class="password-icon">üëÅÔ∏è</span>
          </button>
        </div>
        {% if form.old_password.errors %}
          <div class="form-error">{{ form.old_password.errors.0 }}</div>
        {% endif %}
      </div>

      {# New Password Field #}
      <div class="form-group">
        <label for="id_new_password1">New Password *</label>
        <div class="password-field">
          <input 
            type="password" 
            name="new_password1" 
            id="id_new_password1"
            class="form-control {% if form.new_password1.errors %}is-invalid{% endif %}"
            placeholder="Create a strong password"
            required
          >
          <button type="button" class="password-toggle" data-target="id_new_password1" aria-label="Toggle password visibility">
            <span class="password-icon">üëÅÔ∏è</span>
          </button>
        </div>
        {% if form.new_password1.errors %}
          <div class="form-error">{{ form.new_password1.errors.0 }}</div>
        {% endif %}
        <small class="form-help">At least 8 characters with letters and numbers</small>
      </div>

      {# Confirm New Password Field #}
      <div class="form-group">
        <label for="id_new_password2">Confirm New Password *</label>
        <div class="password-field">
          <input 
            type="password" 
            name="new_password2" 
            id="id_new_password2"
            class="form-control {% if form.new_password2.errors %}is-invalid{% endif %}"
            placeholder="Re-enter your new password"
            required
          >
          <button type="button" class="password-toggle" data-target="id_new_password2" aria-label="Toggle password visibility">
            <span class="password-icon">üëÅÔ∏è</span>
          </button>
        </div>
        {% if form.new_password2.errors %}
          <div class="form-error">{{ form.new_password2.errors.0 }}</div>
        {% endif %}
      </div>

      {# Password Requirements #}
      <div class="password-requirements">
        <h4>Password Requirements:</h4>
        <ul>
          <li id="req-length">At least 8 characters</li>
          <li id="req-letter">Contains at least one letter</li>
          <li id="req-number">Contains at least one number</li>
          <li id="req-match">Passwords match</li>
        </ul>
      </div>

      {# Non-field errors #}
      {% if form.non_field_errors %}
        <div class="alert alert-error">
          {{ form.non_field_errors.0 }}
        </div>
      {% endif %}

      {# Form Actions #}
      <div class="form-actions">
        <button type="submit" class="btn btn-primary">
          Change Password
        </button>
        <a href="{% url 'accounts:profile' %}" class="btn btn-secondary">
          Cancel
        </a>
      </div>
    </form>

    {# Security Tips #}
    <div class="security-tips">
      <h4>Security Tips:</h4>
      <ul>
        <li>Use a unique password you don't use elsewhere</li>
        <li>Consider using a password manager</li>
        <li>Enable two-factor authentication when available</li>
        <li>Never share your password with anyone</li>
      </ul>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{% static 'accounts/js/accounts.js' %}"></script>
{% endblock %}
